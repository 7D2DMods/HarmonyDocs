

<html>
	
<head>
	<title>Scripts</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="generator" content="HelpNDoc Personal Edition 5.2.0.265">
	<meta name="keywords" content="">
	
	
	
	<link type="text/css" rel="stylesheet" media="all" href="css/reset.css" />
	<link type="text/css" rel="stylesheet" media="all" href="css/base.css" />
	<link type="text/css" rel="stylesheet" media="all" href="css/hnd.css" />
	<!--[if lte IE 8]>
		<link type="text/css" rel="stylesheet" media="all" href="css/ielte8.css" />
	<![endif]-->
	<style type="text/css">
		#topic_header
		{
			background-color: #EFEFEF;
		}
	</style>
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/hnd.js"></script>
	<script type="text/javascript">
		$(document).ready(function()
		{
			if (top.frames.length == 0)
			{
				var sTopicUrl = top.location.href.substring(top.location.href.lastIndexOf("/") + 1, top.location.href.length);
				top.location.href = "index.htm?" + sTopicUrl;
			}
			else
			{
				var bTocSelected = false;
				(function waitForTOC()
				{
					if (top && top.FrameTOC && top.FrameTOC.SelectTocItem)
					{
						top.FrameTOC.SelectTocItem("Scripts");
						bTocSelected = true;
					}
					if (!bTocSelected) setTimeout(function() { waitForTOC(); }, 300);
				})();
			}
		});
	</script>
	
	
</head>

<body>



	
		<div id="topic_header">
			<div id="topic_header_content">
				<h1 id="topic_header_text">Scripts</h1>
				
				
				<div id="topic_breadcrumb">
					<a href="HarmonyMods1.html">Harmony Mods</a> &rsaquo;&rsaquo; 
				</div>
				
			</div>
			
			<div id="topic_header_nav">
				
				
				<a href="HarmonyMods1.html"><img src="img/arrow_up.png" alt="Parent"/></a>
				
				
				
				<a href="PatchScripts.html"><img src="img/arrow_left.png" alt="Previous"/></a>
				
				
				
				<a href="Harmony.html"><img src="img/arrow_right.png" alt="Next"/></a>
				
				
			</div>
			
			<div class="clear"></div>
		</div>
	
	
	<div id="topic_content">
		
<p></p>
<p class="rvps2"><span class="rvts6">Scripts are C# scripts which adds new classes to the game, and can be referenced from either other scripts or through XML hooks.</span></p>
<p class="rvps2"><span class="rvts6"><br/></span></p>
<p class="rvps2"><span class="rvts6">This example script adds a new &lt;requirement&gt; for the buffs.xml file. DMT will compile this script into the Mods.dll.</span></p>
<div class="rvps2"><table width="100%" border="1" style="border-color: #000000; border-style: solid; border-spacing: 2px;">
<tr valign="top">
<td style="border-color: #000000; border-style: solid; padding: 1px;"><p class="rvps2"><span class="rvts24">using</span><span class="rvts26"> System;</span></p>
<p class="rvps2"><span class="rvts24">using</span><span class="rvts26"> System.Xml;</span></p>
<p class="rvps2"><span class="rvts24">using</span><span class="rvts26"> UnityEngine;</span></p>
<p class="rvps2"><span class="rvts26"><br/></span></p>
<p class="rvps2"><span class="rvts30">// </span><span class="rvts30"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts30">&lt;requirement name="RequirementSameFactionSDX, Mods" faction="animalsCows" /&gt;</span></p>
<p class="rvps2"><span class="rvts26"><br/></span></p>
<p class="rvps2"><span class="rvts24">public</span><span class="rvts26"> </span><span class="rvts24">class</span><span class="rvts26"> </span><span class="rvts29">RequirementSameFactionSDX</span><span class="rvts26"> : RequirementBase</span></p>
<p class="rvps2"><span class="rvts26">{</span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp;</span><span class="rvts24">public</span><span class="rvts26"> </span><span class="rvts24">string</span><span class="rvts26"> strFaction = </span><span class="rvts25">""</span><span class="rvts26">;</span></p>
<p class="rvps2"><span class="rvts26"><br/></span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp;</span><span class="rvts24">public</span><span class="rvts26"> </span><span class="rvts24">override</span><span class="rvts26"> </span><span class="rvts24">bool</span><span class="rvts26"> ParamsValid(MinEventParams _params)</span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp;{</span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp;Faction myFaction = FactionManager.Instance.GetFaction(_params.Self.factionId);</span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">if</span><span class="rvts26"> (myFaction.Name == strFaction)</span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">return</span><span class="rvts26"> </span><span class="rvts24">true</span><span class="rvts26">;</span></p>
<p class="rvps2"><span class="rvts26"><br/></span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">return</span><span class="rvts26"> </span><span class="rvts24">false</span><span class="rvts26">;</span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp;}</span></p>
<p class="rvps2"><span class="rvts26"><br/></span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp;</span><span class="rvts24">public</span><span class="rvts26"> </span><span class="rvts24">override</span><span class="rvts26"> </span><span class="rvts24">bool</span><span class="rvts26"> ParseXmlAttribute(XmlAttribute _attribute)</span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp;{</span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">string</span><span class="rvts26"> name = _attribute.Name;</span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">if</span><span class="rvts26"> (name != </span><span class="rvts24">null</span><span class="rvts26">)</span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp;{</span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">if</span><span class="rvts26"> (name == </span><span class="rvts25">"faction"</span><span class="rvts26">)</span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{</span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;strFaction = _attribute.Value.ToString();</span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">return</span><span class="rvts26"> </span><span class="rvts24">true</span><span class="rvts26">;</span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">return</span><span class="rvts26"> </span><span class="rvts24">base</span><span class="rvts26">.ParseXmlAttribute(_attribute);</span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp;}</span></p>
<p class="rvps2"><span class="rvts26">}</span></p>
<p class="rvps2"><span class="rvts26"><br/></span></p>
</td>
</tr>
</table>
</div>
<p class="rvps2"><span class="rvts6"><br/></span></p>
<p class="rvps2"><span class="rvts6">While DMT will take care of loading that script into memory, you will need to add an XML XPath file to enable it.</span></p>
<p class="rvps2"><span class="rvts6"><br/></span></p>
<div class="rvps2"><table width="100%" border="1" style="border-color: #000000; border-style: solid; border-spacing: 2px;">
<tr valign="top">
<td style="border-color: #000000; border-style: solid; padding: 1px;"><p class="rvps2"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts26"> </span><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts26">&lt;</span><span class="rvts31">requirement </span><span class="rvts28">name</span><span class="rvts31">=</span><span class="rvts24">"RequirementSameFactionSDX, Mods"</span><span class="rvts31"> </span><span class="rvts28">faction</span><span class="rvts31">=</span><span class="rvts24">"animalsCows"</span><span class="rvts31"> /</span><span class="rvts26">&gt; &nbsp;</span><span class="rvts30">&lt;!-- Requirement will only pass if the entity belongs to this faction --&gt;</span></p>
</td>
</tr>
</table>
</div>
<p class="rvps2"><span class="rvts6"><br/></span></p>
<p class="rvps2"><span class="rvts6">The name,</span><span class="rvts24">"RequirementSameFactionSDX, Mods"</span><span class="rvts6"> is the class name along with the Assembly it's compiled into. For nearly all scripts, this assembly will be Mods, which gets created in the Mods.dll file.</span></p>
<p class="rvps2"><span class="rvts6"><br/></span></p>
<p class="rvps2"><span class="rvts6">There are a few things to note here. </span></p>
<p class="rvps2"><span class="rvts6"><br/></span></p>
<p class="rvps2" style="text-indent: -24px; padding-left: 24px; margin-left: 0px;"><span style="font-size: 12pt; font-family: 'Arial Unicode MS', 'Lucida Sans Unicode', 'Arial'; color: #000000; display: inline-block; text-indent: 0px; min-width: 24px;">•</span><span class="rvts6">The loading of custom classes is different depending on the context in which you are trying to change. For requirements, the class reference is in the "name" attribute. In others, it may be "action", or "value". </span></p>
<p class="rvps2"><span class="rvts6"><br/></span></p>
<p class="rvps2" style="text-indent: -24px; padding-left: 24px; margin-left: 0px;"><span style="font-size: 12pt; font-family: 'Arial Unicode MS', 'Lucida Sans Unicode', 'Arial'; color: #000000; display: inline-block; text-indent: 0px; min-width: 24px;">•</span><span class="rvts6">The "name" value may be different depending on what kind of class you are trying to load. &nbsp;The game will do a GetType() on the name to find the appropriate class name. However, some hooks in vanilla make assumptions about what the class is called.</span></p>
<p class="rvps2"><span class="rvts6"><br/></span></p>
<p class="rvps2"><span class="rvts6">In this example, our class is called MinEventActionPlayerLevelSDX:</span></p>
<div class="rvps2"><table width="100%" border="1" style="border-color: #000000; border-style: solid; border-spacing: 2px;">
<tr valign="top">
<td style="border-color: #000000; border-style: solid; padding: 1px;"><p class="rvps2"><span class="rvts24">using</span><span class="rvts26"> System.Xml;</span></p>
<p class="rvps2"><span class="rvts24">using</span><span class="rvts26"> UnityEngine;</span></p>
<p class="rvps2"><span class="rvts24">public</span><span class="rvts26"> </span><span class="rvts24">class</span><span class="rvts26"> </span><span class="rvts29">MinEventActionPlayerLevelSDX</span><span class="rvts26"> : MinEventActionRemoveBuff</span></p>
<p class="rvps2"><span class="rvts26">{</span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp;</span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp;</span><span class="rvts30">// &nbsp;&lt;triggered_effect trigger="onSelfBuffStart" action="PlayerLevelSDX, Mods" target="self" &nbsp;/&gt; </span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp;</span><span class="rvts24">public</span><span class="rvts26"> </span><span class="rvts24">override</span><span class="rvts26"> </span><span class="rvts24">void</span><span class="rvts26"> Execute(MinEventParams _params)</span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp;{</span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">for</span><span class="rvts26"> (</span><span class="rvts24">int</span><span class="rvts26"> i = 0; i &lt; </span><span class="rvts24">this</span><span class="rvts26">.targets.Count; i++)</span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp;{</span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;EntityPlayerLocal entity = </span><span class="rvts24">this</span><span class="rvts26">.targets[i] </span><span class="rvts24">as</span><span class="rvts26"> EntityPlayerLocal;</span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">if</span><span class="rvts26"> (entity != </span><span class="rvts24">null</span><span class="rvts26">)</span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{</span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">if</span><span class="rvts26"> (entity.Progression.Level &lt; Progression.MaxLevel)</span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{</span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;entity.Progression.Level++;</span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;GameManager.ShowTooltipWithAlert(entity, </span><span class="rvts24">string</span><span class="rvts26">.Format(Localization.Get(</span><span class="rvts25">"ttLevelUp"</span><span class="rvts26">, </span><span class="rvts24">string</span><span class="rvts26">.Empty), entity.Progression.Level.ToString(), entity.Progression.SkillPoints), </span><span class="rvts25">"levelupplayer"</span><span class="rvts26">);</span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></p>
<p class="rvps2"><span class="rvts26"> &nbsp; &nbsp;}</span></p>
<p class="rvps2"><span class="rvts26">}</span></p>
<p class="rvps2"><span class="rvts26"><br/></span></p>
</td>
</tr>
</table>
</div>
<p class="rvps2"><span class="rvts6"><br/></span></p>
<p class="rvps2"><span class="rvts6">In MinEventActionBase, which is the class that loads the MinEventAction calls from the buffs.xml, we look for the GetType() call:</span></p>
<p class="rvps2"><span class="rvts6"><br/></span></p>
<div class="rvps2"><table width="100%" border="1" style="border-color: #000000; border-style: solid; border-spacing: 2px;">
<tr valign="top">
<td style="border-color: #000000; border-style: solid; padding: 1px;"><p class="rvps2"><span class="rvts32">Type</span><span class="rvts33">&nbsp;</span><span class="rvts34">type</span><span class="rvts33">&nbsp;</span><span class="rvts35">=</span><span class="rvts33">&nbsp;</span><span class="rvts32">Type</span><span class="rvts35">.</span><span class="rvts36">GetType</span><span class="rvts33">(</span><span class="rvts37">"MinEventAction"</span><span class="rvts33">&nbsp;</span><span class="rvts35">+</span><span class="rvts33">&nbsp;</span><span class="rvts38">_element</span><span class="rvts35">.</span><span class="rvts39">GetAttribute</span><span class="rvts33">(</span><span class="rvts37">"action"</span><span class="rvts33">));</span></p>
</td>
<td style="border-color: #000000; border-style: solid; padding: 1px;"><br/>
</td>
</tr>
</table>
</div>
<p class="rvps2"><span class="rvts6"><br/></span></p>
<p class="rvps2"><span class="rvts6">Notice it adds "MinEventAction" to the start of the "action" attribute. We need to include that as part of the class name (</span><span class="rvts29">MinEventActionPlayerLevelSDX</span><span class="rvts6"> ), but since the game is appending it, we do not add it as a reference to the XML:</span></p>
<p class="rvps2"><span class="rvts6"><br/></span></p>
<div class="rvps2"><table width="100%" border="1" style="border-color: #000000; border-style: solid; border-spacing: 2px;">
<tr valign="top">
<td style="border-color: #000000; border-style: solid; padding: 1px;"><p class="rvps2"><span class="rvts26"> &nbsp;&lt;triggered_effect trigger=</span><span class="rvts25">"onSelfBuffStart"</span><span class="rvts26"> action=</span><span class="rvts25">"PlayerLevelSDX, Mods"</span><span class="rvts26"> target=</span><span class="rvts25">"self"</span><span class="rvts26"> &nbsp;/&gt; </span></p>
</td>
</tr>
</table>
</div>
<p class="rvps2"><span class="rvts6"><br/></span></p>
<p class="rvps2"><span class="rvts6"><br/></span></p>
<p></p>
<p class="rvps5" style="clear: both;"><span class="rvts13">Created with the Personal Edition of HelpNDoc: </span><a class="rvts14" href="https://www.helpndoc.com/feature-tour">Easily create PDF Help documents</a></p>

	</div>
	
	
		<div id="topic_footer">

			<div id="topic_footer_content">
				Copyright &copy; 2019 by sphereii. All Rights Reserved.
			</div>
		</div>
	
	

	
</body>
	
</html>

