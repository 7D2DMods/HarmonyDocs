

<html>
	
<head>
	<title>Prefix and Postfix</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="generator" content="HelpNDoc Personal Edition 5.2.0.265">
	<meta name="keywords" content="">
	
	
	
	<link type="text/css" rel="stylesheet" media="all" href="css/reset.css" />
	<link type="text/css" rel="stylesheet" media="all" href="css/base.css" />
	<link type="text/css" rel="stylesheet" media="all" href="css/hnd.css" />
	<!--[if lte IE 8]>
		<link type="text/css" rel="stylesheet" media="all" href="css/ielte8.css" />
	<![endif]-->
	<style type="text/css">
		#topic_header
		{
			background-color: #EFEFEF;
		}
	</style>
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/hnd.js"></script>
	<script type="text/javascript">
		$(document).ready(function()
		{
			if (top.frames.length == 0)
			{
				var sTopicUrl = top.location.href.substring(top.location.href.lastIndexOf("/") + 1, top.location.href.length);
				top.location.href = "index.htm?" + sTopicUrl;
			}
			else
			{
				var bTocSelected = false;
				(function waitForTOC()
				{
					if (top && top.FrameTOC && top.FrameTOC.SelectTocItem)
					{
						top.FrameTOC.SelectTocItem("PrefixandPostfix");
						bTocSelected = true;
					}
					if (!bTocSelected) setTimeout(function() { waitForTOC(); }, 300);
				})();
			}
		});
	</script>
	
	
</head>

<body>



	
		<div id="topic_header">
			<div id="topic_header_content">
				<h1 id="topic_header_text">Prefix and Postfix</h1>
				
				
				<div id="topic_breadcrumb">
					<a href="HarmonyMods1.html">Harmony Mods</a> &rsaquo;&rsaquo; <a href="Harmony.html">Harmony</a> &rsaquo;&rsaquo; 
				</div>
				
			</div>
			
			<div id="topic_header_nav">
				
				
				<a href="Harmony.html"><img src="img/arrow_up.png" alt="Parent"/></a>
				
				
				
				<a href="Targetingamethod.html"><img src="img/arrow_left.png" alt="Previous"/></a>
				
				
				
				<a href="TranspilerILEditor.html"><img src="img/arrow_right.png" alt="Next"/></a>
				
				
			</div>
			
			<div class="clear"></div>
		</div>
	
	
	<div id="topic_content">
		
<p></p>
<p class="rvps2"><span class="rvts6">As mentioned before, Harmony allows you to intercept methods, and execute your code before or after they are executed.</span></p>
<p class="rvps2"><span class="rvts6"><br/></span></p>
<p class="rvps2"><span class="rvts6"> </span><span class="rvts15">It's important to note that all Harmony hooks, such as Prefix and Postfix, are static.</span></p>
<p class="rvps2"><span class="rvts6"><br/></span></p>
<p class="rvps2"><span class="rvts6">A Prefix() will execute </span><span class="rvts16">before</span><span class="rvts6"> the targeted method runs. It can prevent the original method from even executing.</span></p>
<p class="rvps2"><span class="rvts6">A Postfix() will execute </span><span class="rvts16">after</span><span class="rvts6"> the targeted method runs, regardless of any conditional logic being handled inside of the original method.</span></p>
<p class="rvps2"><span class="rvts6"><br/></span></p>
<p class="rvps2"><a class="rvts11" href="https://github.com/pardeike/Harmony/wiki/Patching" target="_blank">From the Harmony Wiki:</a></p>
<div class="rvps2"><table width="100%" border="1" style="border-color: #000000; border-style: solid; border-spacing: 2px;">
<tr valign="top">
<td style="border-color: #000000; border-style: solid; padding: 1px;"><p class="rvps11" style="text-indent: -24px; padding-left: 24px; margin-left: 8px;"><span style="font-size: 12pt; font-family: 'Arial Unicode MS', 'Lucida Sans Unicode', 'Arial'; color: #24292e; display: inline-block; text-indent: 0px; min-width: 24px;">•</span><span class="rvts21">A patch must be a&nbsp;</span><span class="rvts45">static</span><span class="rvts21">&nbsp;method</span></p>
<p class="rvps12" style="text-indent: -24px; padding-left: 24px; margin-left: 8px;"><span style="font-size: 12pt; font-family: 'Arial Unicode MS', 'Lucida Sans Unicode', 'Arial'; color: #24292e; display: inline-block; text-indent: 0px; min-width: 24px;">•</span><span class="rvts21">A prefix patch has a return type of&nbsp;</span><span class="rvts45">void</span><span class="rvts21">&nbsp;or&nbsp;</span><span class="rvts45">bool</span></p>
<p class="rvps12" style="text-indent: -24px; padding-left: 24px; margin-left: 8px;"><span style="font-size: 12pt; font-family: 'Arial Unicode MS', 'Lucida Sans Unicode', 'Arial'; color: #24292e; display: inline-block; text-indent: 0px; min-width: 24px;">•</span><span class="rvts21">A postfix patch has a return type of&nbsp;</span><span class="rvts45">void</span><span class="rvts21">&nbsp;or the return signature must match the type of the&nbsp;</span><span class="rvts45">first</span><span class="rvts21">parameter (passthrough mode)</span></p>
<p class="rvps12" style="text-indent: -24px; padding-left: 24px; margin-left: 8px;"><span style="font-size: 12pt; font-family: 'Arial Unicode MS', 'Lucida Sans Unicode', 'Arial'; color: #24292e; display: inline-block; text-indent: 0px; min-width: 24px;">•</span><span class="rvts21">Patches can use a parameter named&nbsp;</span><span class="rvts45">__instance</span><span class="rvts21">&nbsp;to access the instance value if original method is not static</span></p>
<p class="rvps12" style="text-indent: -24px; padding-left: 24px; margin-left: 8px;"><span style="font-size: 12pt; font-family: 'Arial Unicode MS', 'Lucida Sans Unicode', 'Arial'; color: #24292e; display: inline-block; text-indent: 0px; min-width: 24px;">•</span><span class="rvts21">Patches can use a parameter named&nbsp;</span><span class="rvts45">__result</span><span class="rvts21">&nbsp;to access the returned value (prefixes get default value)</span></p>
<p class="rvps12" style="text-indent: -24px; padding-left: 24px; margin-left: 8px;"><span style="font-size: 12pt; font-family: 'Arial Unicode MS', 'Lucida Sans Unicode', 'Arial'; color: #24292e; display: inline-block; text-indent: 0px; min-width: 24px;">•</span><span class="rvts21">Patches can use a parameter named&nbsp;</span><span class="rvts45">__state</span><span class="rvts21">&nbsp;to store information in the prefix method that can be accessed again in the postfix method. Think of it as a local variable. It can be any type and you are responsible to initialize its value in the prefix</span></p>
<p class="rvps12" style="text-indent: -24px; padding-left: 24px; margin-left: 8px;"><span style="font-size: 12pt; font-family: 'Arial Unicode MS', 'Lucida Sans Unicode', 'Arial'; color: #24292e; display: inline-block; text-indent: 0px; min-width: 24px;">•</span><span class="rvts21">Parameter names starting with three underscores, for example&nbsp;</span><span class="rvts45">___someField</span><span class="rvts21">, can be used to read and write (with 'ref') private fields on the instance that has the same name (minus the underscores)</span></p>
<p class="rvps12" style="text-indent: -24px; padding-left: 24px; margin-left: 8px;"><span style="font-size: 12pt; font-family: 'Arial Unicode MS', 'Lucida Sans Unicode', 'Arial'; color: #24292e; display: inline-block; text-indent: 0px; min-width: 24px;">•</span><span class="rvts21">Patches can define only those parameters they want to access (no need to define all)</span></p>
<p class="rvps12" style="text-indent: -24px; padding-left: 24px; margin-left: 8px;"><span style="font-size: 12pt; font-family: 'Arial Unicode MS', 'Lucida Sans Unicode', 'Arial'; color: #24292e; display: inline-block; text-indent: 0px; min-width: 24px;">•</span><span class="rvts21">Patch parameters must use the&nbsp;</span><span class="rvts45">exact</span><span class="rvts21">&nbsp;same name and type as the original method (</span><span class="rvts46">object</span><span class="rvts21">&nbsp;is ok too)</span></p>
<p class="rvps12" style="text-indent: -24px; padding-left: 24px; margin-left: 8px;"><span style="font-size: 12pt; font-family: 'Arial Unicode MS', 'Lucida Sans Unicode', 'Arial'; color: #24292e; display: inline-block; text-indent: 0px; min-width: 24px;">•</span><span class="rvts21">Patches can either get parameters normally or by declaring any parameter&nbsp;</span><span class="rvts45">ref</span><span class="rvts21">&nbsp;(for manipulation)</span></p>
<p class="rvps12" style="text-indent: -24px; padding-left: 24px; margin-left: 8px;"><span style="font-size: 12pt; font-family: 'Arial Unicode MS', 'Lucida Sans Unicode', 'Arial'; color: #24292e; display: inline-block; text-indent: 0px; min-width: 24px;">•</span><span class="rvts21">To allow patch reusing, one can inject the original method by using a parameter named&nbsp;</span><span class="rvts45">__originalMethod</span></p>
</td>
</tr>
</table>
</div>
<p class="rvps2"><span class="rvts6"><br/></span></p>
<p class="rvps2"><span class="rvts6">To better understand the supported parameters, here's a table from the Harmony Wiki:</span></p>
<p class="rvps2"><span class="rvts6"><br/></span></p>
<div class="rvps2"><table width="100%" border="1" style="border-color: #000000; border-style: solid; border-spacing: 2px;">
<tr valign="top">
<td style="border-color: #000000; border-style: solid; padding: 1px;"><p class="rvps13"><span class="rvts48">// original method in class Customer</span><br/><span class="rvts49">private</span><span class="rvts50"> </span><span class="rvts51">List</span><span class="rvts50">&lt;</span><span class="rvts49">string</span><span class="rvts50">&gt; </span><span class="rvts51">getNames</span><span class="rvts50">(</span><span class="rvts49">int</span><span class="rvts50"> count, </span><span class="rvts49">out</span><span class="rvts50"> </span><span class="rvts51">Error</span><span class="rvts50"> error)</span><br/><span class="rvts48">// prefix</span><br/><span class="rvts48">// - wants instance, result and count</span><br/><span class="rvts48">// - wants to change count</span><br/><span class="rvts48">// - returns a boolean that controls if original is executed (true) or not (false)</span><br/><span class="rvts50">static bool Prefix(</span><span class="rvts51">Customer</span><span class="rvts50"> __instance, </span><span class="rvts51">List</span><span class="rvts50">&lt;</span><span class="rvts49">string</span><span class="rvts50">&gt; __result, </span><span class="rvts49">ref</span><span class="rvts50"> </span><span class="rvts49">int</span><span class="rvts50"> count)</span><br/><span class="rvts48">// postfix</span><br/><span class="rvts48">// - wants result and error</span><br/><span class="rvts48">// - does not change any of those</span><br/><span class="rvts50">static void Postfix(</span><span class="rvts51">List</span><span class="rvts50">&lt;</span><span class="rvts49">string</span><span class="rvts50">&gt; __result, </span><span class="rvts51">Error</span><span class="rvts50"> error)</span></p>
</td>
</tr>
</table>
</div>
<p class="rvps2"><span class="rvts6"><br/></span></p>
<p class="rvps2"><span class="rvts6">Let's do some examples of Prefix() calls. Postfix() calls are very similar, with only their execution order and return values being different. </span></p>
<p class="rvps2"><span class="rvts6"><br/></span></p>
<p class="rvps2"><span class="rvts47">EntityAlive.SetAttackTarget()</span></p>
<p class="rvps2"><span class="rvts6"><br/></span></p>
<p class="rvps6"><span class="rvts6">Vanilla Target: </span><span class="rvts43">public</span><span class="rvts33">&nbsp;</span><span class="rvts43">void</span><span class="rvts33">&nbsp;</span><span class="rvts39">SetAttackTarget</span><span class="rvts33">(</span><span class="rvts32">EntityAlive</span><span class="rvts33">&nbsp;</span><span class="rvts38">_attackTarget</span><span class="rvts33">,&nbsp;</span><span class="rvts43">int</span><span class="rvts33">&nbsp;</span><span class="rvts38">_attackTargetTime</span><span class="rvts33">)</span></p>
<p class="rvps6"><span class="rvts33"><br/></span></p>
<p class="rvps6"><span class="rvts6">For this example, we want to access a custom method from a custom class that inherits from EntityAlive. The original method is not virtual, so while we can call it from our custom class, we cannot over-ride it. The parameters of this method are _attackTarget and _attackTargetTime, but those are not valuable to us for this case. What we want is access to the entire class to see if it's actually our custom class or not. In order to do that, we need to pass in the class type plus the special Harmony keyword "__instance". </span></p>
<p class="rvps6"><span class="rvts6"><br/></span></p>
<p class="rvps6"><span class="rvts6">In our Prefix, we define our Prefix as: </span><span class="rvts24">static</span><span class="rvts26"> </span><span class="rvts24">bool</span><span class="rvts26"> Prefix(EntityAlive __instance)</span></p>
<p class="rvps6"><span class="rvts6"><br/></span></p>
<div class="rvps6"><table width="100%" border="1" style="border-color: #000000; border-style: solid; border-spacing: 2px;">
<tr valign="top">
<td style="border-color: #000000; border-style: solid; padding: 1px;"><p class="rvps6"><span class="rvts26"> &nbsp; &nbsp;[HarmonyPatch(</span><span class="rvts24">typeof</span><span class="rvts26">(EntityAlive))]</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp;[HarmonyPatch(</span><span class="rvts25">"SetAttackTarget"</span><span class="rvts26">)]</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp;</span><span class="rvts24">public</span><span class="rvts26"> </span><span class="rvts24">class</span><span class="rvts26"> </span><span class="rvts29">SphereII_EntityAlive_SetAttackTarget</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp;{</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">static</span><span class="rvts26"> </span><span class="rvts24">bool</span><span class="rvts26"> Prefix(EntityAlive __instance)</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp;{</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts30">// If a door is found, try to open it. If it returns false, start attacking it.</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;EntityAliveSDX myEntity = __instance </span><span class="rvts24">as</span><span class="rvts26"> EntityAliveSDX;</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">if</span><span class="rvts26"> (myEntity)</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;myEntity.RestoreSpeed();</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">return</span><span class="rvts26"> </span><span class="rvts24">true</span><span class="rvts26">;</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp;}</span></p>
</td>
</tr>
</table>
</div>
<p class="rvps6"><span class="rvts6"><br/></span></p>
<p class="rvps6"><span class="rvts6">We return true since we still want the original method to run.</span></p>
<p class="rvps6"><span class="rvts6"><br/></span></p>
<p class="rvps2"><span class="rvts6"><br/></span></p>
<p class="rvps2"><span class="rvts47">XUiC_TipWindow.ShowTip()</span></p>
<p class="rvps2"><span class="rvts47"><br/></span></p>
<p class="rvps6"><span class="rvts6">Vanilla Target: </span><span class="rvts43">public</span><span class="rvts33">&nbsp;</span><span class="rvts43">static</span><span class="rvts33">&nbsp;</span><span class="rvts43">void</span><span class="rvts33">&nbsp;</span><span class="rvts36">ShowTip</span><span class="rvts33">(</span><span class="rvts43">string</span><span class="rvts33">&nbsp;</span><span class="rvts38">tip</span><span class="rvts33">,&nbsp;</span><span class="rvts32">EntityPlayerLocal</span><span class="rvts33">&nbsp;</span><span class="rvts38">_localPlayer</span><span class="rvts33">,&nbsp;</span><span class="rvts32">ToolTipEvent</span><span class="rvts33">&nbsp;</span><span class="rvts38">closeEvent</span><span class="rvts33">)</span></p>
<p class="rvps6"><span class="rvts33"><br/></span></p>
<p class="rvps6"><span class="rvts6">The below example was designed to prevent the TipWindow from showing a tip on the screen. We define that the method we want to target is in the XUiC_TipWindow class, and it's the ShowTip method. There's only one ShowTip() method in the class, so we do not need to specify the parameter signature.</span></p>
<p class="rvps6"><span class="rvts6"><br/></span></p>
<div class="rvps6"><table width="100%" border="1" style="border-color: #000000; border-style: solid; border-spacing: 2px;">
<tr valign="top">
<td style="border-color: #000000; border-style: solid; padding: 1px;"><p class="rvps6"><span class="rvts26"> &nbsp; &nbsp;</span><span class="rvts30">// Removes the Tool Tips for Journal</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp;[HarmonyPatch(</span><span class="rvts24">typeof</span><span class="rvts26">(XUiC_TipWindow))]</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp;[HarmonyPatch(</span><span class="rvts25">"ShowTip"</span><span class="rvts26">)]</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp;</span><span class="rvts24">public</span><span class="rvts26"> </span><span class="rvts24">class</span><span class="rvts26"> </span><span class="rvts29">SphereII_ClearUI_XUiC_TipWindow</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp;{</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">static</span><span class="rvts26"> </span><span class="rvts24">bool</span><span class="rvts26"> Prefix()</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp;{</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">return</span><span class="rvts26"> </span><span class="rvts24">false</span><span class="rvts26">;</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp;}</span></p>
</td>
</tr>
</table>
</div>
<p class="rvps6"><span class="rvts6"><br/></span></p>
<p class="rvps6"><span class="rvts6">This Prefix() simply returns false, which will cause the original ShowTip() method not to execute at all.</span></p>
<p class="rvps2"><span class="rvts6"><br/></span></p>
<p class="rvps2"><span class="rvts6"><br/></span></p>
<p class="rvps2"><span class="rvts47">Block.PlaceBlock():</span></p>
<p class="rvps2"><span class="rvts6"><br/></span></p>
<p class="rvps6"><span class="rvts6">Vanilla Target:</span><span class="rvts43"> public</span><span class="rvts33">&nbsp;</span><span class="rvts43">virtual</span><span class="rvts33">&nbsp;</span><span class="rvts43">void</span><span class="rvts33">&nbsp;</span><span class="rvts39">PlaceBlock</span><span class="rvts33">(</span><span class="rvts32">WorldBase</span><span class="rvts33">&nbsp;</span><span class="rvts38">_world</span><span class="rvts33">,&nbsp;</span><span class="rvts32">BlockPlacement</span><span class="rvts35">.</span><span class="rvts44">Result</span><span class="rvts33">&nbsp;</span><span class="rvts38">_result</span><span class="rvts33">,&nbsp;</span><span class="rvts32">EntityAlive</span><span class="rvts33">&nbsp;</span><span class="rvts38">_ea</span><span class="rvts33">)</span></p>
<p class="rvps6"><span class="rvts33"><br/></span></p>
<p class="rvps6"><span class="rvts6">We see that it has a WorldBase, BlockPlacement and EntityAlive as parameters. For the purpose of the mod, preventing placing blocks while in the air, we only want to access the EntityAlive. This is so we can check what the EntityAlive is actually doing at the time of the call. Rather than placing all the parameters of the method, and not using them, Harmony allows us to specify just the parameters we want to use. </span></p>
<p class="rvps6"><span class="rvts6"><br/></span></p>
<div class="rvps6"><table width="100%" border="1" style="border-color: #000000; border-style: solid; border-spacing: 2px;">
<tr valign="top">
<td style="border-color: #000000; border-style: solid; padding: 1px;"><p class="rvps6"><span class="rvts26"> &nbsp; &nbsp;</span><span class="rvts30">// Returns true for the default PlaceBlock code to execute. If it returns false, it won't execute it at all.</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp;</span><span class="rvts24">static</span><span class="rvts26"> </span><span class="rvts24">bool</span><span class="rvts26"> Prefix(EntityAlive _ea)</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp;{</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp;Debug.Log(</span><span class="rvts25">"Prefix PlaceBox"</span><span class="rvts26">);</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp;EntityPlayerLocal player = _ea </span><span class="rvts24">as</span><span class="rvts26"> EntityPlayerLocal;</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">if</span><span class="rvts26">(player == </span><span class="rvts24">null</span><span class="rvts26">)</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">return</span><span class="rvts26"> </span><span class="rvts24">true</span><span class="rvts26">;</span></p>
<p class="rvps6"><span class="rvts26"><br/></span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">if</span><span class="rvts26">(player.IsGodMode == </span><span class="rvts24">true</span><span class="rvts26">)</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">return</span><span class="rvts26"> </span><span class="rvts24">true</span><span class="rvts26">;</span></p>
<p class="rvps6"><span class="rvts26"><br/></span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">if</span><span class="rvts26">(player.IsFlyMode == </span><span class="rvts24">true</span><span class="rvts26">)</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">return</span><span class="rvts26"> </span><span class="rvts24">true</span><span class="rvts26">;</span></p>
<p class="rvps6"><span class="rvts26"><br/></span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">if</span><span class="rvts26">(player.IsInElevator())</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">return</span><span class="rvts26"> </span><span class="rvts24">true</span><span class="rvts26">;</span></p>
<p class="rvps6"><span class="rvts26"><br/></span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">if</span><span class="rvts26">(player.IsInWater())</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">return</span><span class="rvts26"> </span><span class="rvts24">true</span><span class="rvts26">;</span></p>
<p class="rvps6"><span class="rvts26"><br/></span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts30">// If you aren't on the ground, don't place the block.</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">if</span><span class="rvts26">(!player.onGround)</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">return</span><span class="rvts26"> </span><span class="rvts24">false</span><span class="rvts26">;</span></p>
<p class="rvps6"><span class="rvts26"><br/></span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">return</span><span class="rvts26"> </span><span class="rvts24">true</span><span class="rvts26">;</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp;}</span></p>
</td>
</tr>
</table>
</div>
<p class="rvps6"><span class="rvts6"><br/></span></p>
<p class="rvps6"><span class="rvts6">We have a mix of return types here. If we return false, then the original method will not execute. In the context of this logic, that means the block will not be placed. If it's true, then the original method will be called, and all of its logic will be applied before ultimately deciding to place the block or not.</span></p>
<p class="rvps2"><span class="rvts6"><br/></span></p>
<p class="rvps2"><span class="rvts47">EntityFactory.addEntityToGameObject():</span></p>
<p class="rvps2"><span class="rvts47"><br/></span></p>
<p class="rvps6"><span class="rvts6">Vanilla target: </span><span class="rvts43">private</span><span class="rvts33">&nbsp;</span><span class="rvts43">static</span><span class="rvts33">&nbsp;</span><span class="rvts32">Entity</span><span class="rvts33">&nbsp;</span><span class="rvts36">addEntityToGameObject</span><span class="rvts33">(</span><span class="rvts32">GameObject</span><span class="rvts33">&nbsp;</span><span class="rvts38">_gameObject</span><span class="rvts33">,&nbsp;</span><span class="rvts43">string</span><span class="rvts33">&nbsp;</span><span class="rvts38">_className</span><span class="rvts33">)</span></p>
<p class="rvps6"><span class="rvts33"><br/></span></p>
<p class="rvps6"><span class="rvts6">To load custom entity's, we need to add in a hook to the EntityFactory. For this example, we are going to use a Postfix(). That is, we are going to let the original method run, look at its return type to see if it's something we want. and change it if necessary.</span></p>
<p class="rvps6"><span class="rvts6"><br/></span></p>
<div class="rvps6"><table width="100%" border="1" style="border-color: #000000; border-style: solid; border-spacing: 2px;">
<tr valign="top">
<td style="border-color: #000000; border-style: solid; padding: 1px;"><p class="rvps6"><span class="rvts26"> &nbsp; &nbsp;</span><span class="rvts24">static</span><span class="rvts26"> Entity Postfix(Entity __result, GameObject _gameObject, </span><span class="rvts24">string</span><span class="rvts26"> _className)</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp;{</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">if</span><span class="rvts26">(__result == </span><span class="rvts24">null</span><span class="rvts26">)</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp;{</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Type type = Type.GetType(_className + </span><span class="rvts25">", Mods"</span><span class="rvts26">);</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">if</span><span class="rvts26">(type != </span><span class="rvts24">null</span><span class="rvts26">)</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">return</span><span class="rvts26"> (Entity)_gameObject.AddComponent(type);</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">return</span><span class="rvts26"> __result;</span></p>
<p class="rvps6"><span class="rvts26"> &nbsp; &nbsp;}</span></p>
</td>
</tr>
</table>
</div>
<p class="rvps6"><span class="rvts6"><br/></span></p>
<p class="rvps6"><span class="rvts6">If the original method returns null, that means it could not find the entity class, and is returning null. </span><span class="rvts16">Entity __result </span><span class="rvts6">parameter is passed into the Postfix() method as the return value of the original method. Since it's null, we want to add the ", Mods" to allow it to look in our custom Mods assembly (mods.dll). </span></p>
<p class="rvps6"><span class="rvts6"><br/></span></p>
<p class="rvps6"><span class="rvts6">Because a Postfix() may return a void or the original return type, we either return our new reference, or simply return the original __result value.</span></p>
<p></p>
<p class="rvps5" style="clear: both;"><span class="rvts13">Created with the Personal Edition of HelpNDoc: </span><a class="rvts14" href="https://www.helpauthoringsoftware.com">Benefits of a Help Authoring Tool</a></p>

	</div>
	
	
		<div id="topic_footer">

			<div id="topic_footer_content">
				Copyright &copy; 2019 by sphereii. All Rights Reserved.
			</div>
		</div>
	
	

	
</body>
	
</html>

